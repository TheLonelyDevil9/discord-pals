{% extends "base.html" %}
{% block title %}Character Preview - Discord Pals{% endblock %}

{% block content %}
<style>
    .preview-controls {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 20px;
    }

    .preview-controls select {
        padding: 10px 15px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 6px;
        font-size: 1em;
        min-width: 200px;
    }

    .preview-box {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
    }

    .preview-content {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 0.9em;
        line-height: 1.6;
        max-height: 600px;
        overflow-y: auto;
    }

    .preview-meta {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        color: var(--text-muted);
        font-size: 0.9em;
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: var(--text-muted);
    }
</style>

<h1>ðŸ”® Character Preview</h1>
<p style="color: var(--text-muted); margin-bottom: 20px;">
    See how the complete system prompt looks for each character with mock values.
</p>

<div class="preview-controls">
    <select id="character-select" onchange="loadPreview()">
        <option value="">Select a character...</option>
        {% for char in characters %}
        <option value="{{ char }}">{{ char }}</option>
        {% endfor %}
    </select>
    <button class="btn btn-primary" onclick="loadPreview()">Preview</button>
</div>

<div class="preview-box">
    <div id="preview-meta" class="preview-meta" style="display: none;">
        <span>Character: <strong id="preview-char"></strong></span>
        <span>Est. Tokens: <strong id="preview-tokens"></strong></span>
    </div>
    <div id="preview-content" class="preview-content">
        <div class="loading">Select a character to preview the system prompt</div>
    </div>
</div>

<script>
    async function loadPreview() {
        const select = document.getElementById('character-select');
        const charName = select.value;

        if (!charName) {
            document.getElementById('preview-content').innerHTML =
                '<div class="loading">Select a character to preview the system prompt</div>';
            document.getElementById('preview-meta').style.display = 'none';
            return;
        }

        document.getElementById('preview-content').innerHTML = '<div class="loading">Loading...</div>';

        try {
            const response = await fetch('/api/preview/' + encodeURIComponent(charName));
            const data = await response.json();

            if (data.error) {
                document.getElementById('preview-content').textContent = 'Error: ' + data.error;
            } else {
                document.getElementById('preview-content').textContent = data.prompt;
                document.getElementById('preview-char').textContent = data.character;
                document.getElementById('preview-tokens').textContent = '~' + data.token_estimate;
                document.getElementById('preview-meta').style.display = 'flex';
            }
        } catch (err) {
            document.getElementById('preview-content').textContent = 'Error loading preview: ' + err.message;
        }
    }
</script>
{% endblock %}